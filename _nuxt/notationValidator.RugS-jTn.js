const g="King",W="Queen",P="Rook",N="Bishop",k="Knight",s="Pawn",h={english:{K:g,Q:W,R:P,B:N,N:k,P:s}},A=t=>t.notation.endsWith(" (=)")?{...t,offeredDraw:!0,notation:t.notation.slice(0,-4)}:t,m=t=>t.notation.endsWith(" e.p.")?{...t,enPassant:!0,notation:t.notation.slice(0,-5)}:t,V=t=>t.notation.endsWith("++")?{...t,checkmate:!0,notation:t.notation.slice(0,-2)}:t.notation.endsWith("#")?{...t,checkmate:!0,notation:t.notation.slice(0,-1)}:t.notation.endsWith("+")?{...t,check:!0,notation:t.notation.slice(0,-1)}:t,I=t=>t.notation==="0-0-0"||t.notation==="O-O-O"?{...t,queensideCastle:!0,notation:""}:t.notation==="0-0"||t.notation==="O-O"?{...t,kingsideCastle:!0,notation:""}:t,w=t=>{const e=t.notation.slice(-1),n=t.notation.slice(-2,-1)==="=";if(h[t.language][e]){const r=n?t.notation.slice(0,-2):t.notation.slice(0,-1);return{...t,promotion:h[t.language][e],notation:r}}return t},D=t=>/[a-h][1-8]$/.exec(t.notation)?{...t,to:t.notation.slice(-2),notation:t.notation.slice(0,-2)}:t,K=t=>t.notation.endsWith("x")?{...t,capture:!0,notation:t.notation.slice(0,-1)}:t,x=t=>/[a-h][1-8]$/.exec(t.notation)?{...t,from:t.notation.slice(-2),notation:t.notation.slice(0,-2)}:/([a-h]$)|([1-8]$)/.exec(t.notation)?{...t,from:t.notation.slice(-1),notation:t.notation.slice(0,-1)}:t,E=t=>h[t.language][t.notation]?{...t,piece:h[t.language][t.notation],notation:t.notation.slice(0,-1)}:{...t,piece:s},T=({offeredDraw:t,checkmate:e})=>!(t&&e),$=({enPassant:t,queensideCastle:e,kingsideCastle:n,to:r,piece:c,capture:f})=>t?!(e||n||c!==s||!r||!r.endsWith(6)&&!r.endsWith(3)||!f):!0,q=({check:t,checkmate:e,from:n,to:r,queensideCastle:c,kingsideCastle:f,piece:d})=>!t&&!e||!n?!0:!(!r&&(!c||!f)||d===g&&(n.startsWith("a")&&r.startsWith("a")||n.startsWith("h")&&r.startsWith("h")||n.endsWith("1")&&r.endsWith("1")||n.endsWith("8")&&r.endsWith("8")||n==="a8"||n==="h8"||n==="a1"||n==="h1")),B=({to:t,piece:e,promotion:n})=>n?!(n===s||!t||!t.endsWith(8)&&!t.endsWith(1)||e!==s):!0,F=({from:t,to:e,capture:n,piece:r})=>!(t&&e&&n&&r===s&&t.startsWith(e.charAt(0))),M=({from:t,to:e,promotion:n,enPassant:r,capture:c,queensideCastle:f,kingsideCastle:d,piece:C})=>{if(f||d)return!0;if(!e||t===e)return!1;const v=e.charCodeAt(0),l=Number.parseInt(e.charAt(1),10);let a=null,i=null;t&&t.length===2?(a=t.charCodeAt(0),i=Number.parseInt(t.charAt(1),10)):t&&t.length===1&&(Number.isNaN(Number.parseInt(t,10))?a=t.charCodeAt(0):i=Number.parseInt(t,10));const u=a?Math.abs(a-v):-10,o=i?Math.abs(i-l):-10;switch(C){case g:return u<=1&&o<=1;case W:return o<1||u<1||u===o;case P:return o<1||u<1;case N:return a&&i?u===o:a?u>0:i?o>0:!0;case k:return a&&i?u===1&&o===2||u===2&&o===1:a?u===1||u===2:i?o===1||o===2:!0;case s:if(i===1||i===8||u>1||u===1&&o!==1&&o!==-10||u===1&&!c||o>2||o===2&&i!==2&&i!==7&&i!==-10||(l===8||l===1)&&n===null||r&&(l!==3&&l!==6||i&&i!==4&&l===3||i&&i!==5&&l===6))return!1}return!0},Q=({notation:t,language:e="english"})=>{let n={notation:t,language:e,offeredDraw:null,enPassant:null,check:null,checkmate:null,queensideCastle:null,kingsideCastle:null,promotion:null,to:null,capture:null,from:null,piece:null,notationAfterParsing:null};return n=A(n),n=m(n),n=V(n),n=I(n),n=w(n),n=D(n),n=K(n),n=x(n),n=E(n),{...n,notation:t,notationAfterParsing:n.notation}},R=t=>T(t)&&$(t)&&q(t)&&B(t)&&F(t)&&M(t)&&t.notationAfterParsing==="",G=({notation:t,language:e="english"})=>R(Q({notation:t,language:e}));export{G as i,Q as p};
